# 7 Wonders Duel C++ 项目总结

## 项目概述

本项目是一个完整实现的 **7 Wonders Duel (七大奇迹:对决)** 桌游的C++控制台版本。项目严格遵循面向对象编程原则,实现了游戏的全部核心机制,包括三个时代的卡牌系统、军事冲突、科技发展、奇迹建造和多种胜利条件。

## 项目规模

- **总代码行数**: 约 3,626 行
- **文件数量**: 39 个源文件和头文件
- **模块数量**: 6 个主要模块 (cards, game, player, resources, ui, types)
- **类数量**: 30+ 个类,涵盖游戏的各个方面

## 核心功能实现

### 1. 完整的卡牌系统

实现了所有三个时代的卡牌,包括:

- **时代 I**: 20 张卡牌 (原材料、制成品、平民建筑、科学建筑、商业建筑、军事建筑)
- **时代 II**: 20 张卡牌 (更高级的建筑和资源)
- **时代 III**: 20 张卡牌 (包括3张随机公会卡)
- **奇迹卡**: 12 张奇迹,每张具有独特效果
- **公会卡**: 7 张公会卡,提供多样化的计分方式

每种卡牌类型都有独特的效果实现:

- **原材料和制成品卡**: 提供建造所需的资源
- **平民建筑**: 提供胜利点数
- **科学建筑**: 提供科学符号,收集相同符号对可获得进度标记
- **军事建筑**: 提供军事力量,推动军事轨道
- **商业建筑**: 提供金币、降低交易成本或其他经济效果
- **公会卡**: 根据双方玩家的建筑情况提供可变的胜利点数

### 2. 游戏机制

#### 金字塔卡牌结构

实现了三个时代的金字塔布局,每个时代有不同的卡牌排列方式。金字塔结构支持:

- 卡牌的面朝上/面朝下状态
- 自动计算可访问的卡牌(只有没有被覆盖的卡牌才能选择)
- 当卡牌被移除时,自动翻开下层的面朝下卡牌

#### 军事轨道系统

完整实现了军事冲突机制:

- 冲突棋子在 -9 到 +9 的轨道上移动
- 在特定位置触发军事标记,给予金币奖励或惩罚
- 当冲突棋子到达对手首都(±9)时,立即触发军事胜利

#### 科技发展系统

实现了科学符号收集和进度标记机制:

- 6 种科学符号 (指南针、齿轮、石板、天平等)
- 收集相同符号对可选择进度标记
- 10 种进度标记,每种提供独特的游戏效果
- 收集 6 种不同科学符号可触发科技胜利

### 3. AI 对战系统

实现了两种AI策略:

#### RandomAI (随机AI)

- 从所有可能的合法行动中随机选择
- 适合测试游戏逻辑和快速对局

#### GreedyAI (贪心AI)

- 评估每张卡牌的价值
- 考虑建造成本、胜利点数、特殊效果等因素
- 选择当前回合最有价值的行动
- 能够做出基本的战术决策

### 4. 胜利条件

实现了三种胜利方式:

1. **军事胜利**: 冲突棋子到达对手首都
2. **科技胜利**: 收集 6 种不同的科学符号
3. **平民胜利**: 游戏结束时计算胜利点数,点数高者获胜

胜利点数来源包括:

- 建筑卡牌的点数
- 奇迹的点数
- 进度标记的点数
- 金币 (每3金币1点)
- 公会卡的可变点数

### 5. 用户界面

实现了清晰的控制台界面:

- 实时显示游戏状态(军事轨道、玩家信息、可用卡牌)
- 显示玩家的建筑、奇迹、科学符号和进度标记
- 提供直观的行动选择菜单
- 显示详细的最终得分统计

## 技术亮点

### 1. 面向对象设计

项目采用了多种设计模式:

- **策略模式**: `PlayerStrategy` 接口允许灵活切换人类玩家和AI
- **工厂模式**: `CardFactory` 集中管理所有卡牌的创建
- **模板方法模式**: `Card` 基类定义了卡牌的通用行为框架
- **组合模式**: `GameBoard` 组合了多个游戏组件

### 2. 模块化架构

项目被清晰地划分为多个模块:

```
cards/       - 卡牌系统
game/        - 游戏核心逻辑
player/      - 玩家和AI策略
resources/   - 资源和成本管理
ui/          - 用户界面
```

每个模块都有明确的职责,模块之间通过定义良好的接口进行交互。

### 3. 可扩展性

项目设计考虑了未来的扩展:

- 添加新的AI策略只需继承 `AIStrategy` 类
- 添加新的卡牌只需继承 `Card` 类并在 `CardFactory` 中注册
- 添加新的游戏模式只需修改 `Game` 类的流程控制

## 编译和运行

### 编译

```bash
cd 7wonders_duel
make
```

### 运行

```bash
./bin/7wonders_duel
```

### 清理

```bash
make clean
```

## 项目文件结构

```
7wonders_duel/
├── bin/                      # 可执行文件
├── obj/                      # 编译中间文件
├── include/                  # 头文件
│   ├── cards/               # 卡牌类
│   ├── game/                # 游戏逻辑
│   ├── player/              # 玩家和策略
│   ├── resources/           # 资源管理
│   └── ui/                  # 用户界面
├── src/                      # 源文件实现
├── Makefile                  # 编译配置
├── README.md                 # 项目说明
└── implementation_details.md # 实现思路
```

## 实现思路

### 核心设计理念

本项目的核心设计理念是将复杂的游戏规则分解为一系列**独立、可复用的对象**。每个对象负责游戏的一个特定方面,通过清晰的接口与其他对象交互。

### 关键设计决策

1. **卡牌继承体系**: 使用抽象基类 `Card` 定义通用接口,具体卡牌类型继承并实现特定行为。这使得添加新卡牌类型变得简单。

2. **策略模式的应用**: 将玩家的决策逻辑从 `Player` 类中分离出来,使得人类玩家和AI可以共享相同的游戏状态管理代码。

3. **游戏状态的集中管理**: `GameBoard` 类作为游戏状态的中心,管理所有公共组件(军事轨道、卡牌结构、进度标记)。

4. **资源计算的抽象**: 将资源成本计算封装在 `Player` 类中,考虑了玩家自己的资源、从对手购买资源的价格以及商业建筑的折扣效果。

### 实现挑战与解决方案

#### 挑战1: 卡牌的复杂效果

**问题**: 不同卡牌有非常多样化的效果,如何统一处理?

**解决方案**: 使用虚函数 `apply()` 让每种卡牌实现自己的效果逻辑。对于需要在游戏结束时计算的效果(如公会卡),使用 `getVictoryPoints()` 方法动态计算。

#### 挑战2: AI决策

**问题**: 如何让AI做出合理的决策?

**解决方案**: 实现了一个评估函数,根据卡牌类型、成本、当前游戏状态等因素给每个可能的行动打分。贪心AI选择得分最高的行动。

#### 挑战3: 金字塔结构的可访问性

**问题**: 如何判断金字塔中哪些卡牌是可以选择的?

**解决方案**: 实现了 `CardSlot::isAccessible()` 方法,检查卡牌下方的两个位置是否都没有卡牌覆盖。

## 测试与验证

项目通过以下方式进行了测试:

1. **编译测试**: 确保所有代码能够成功编译,无语法错误
2. **功能测试**: 通过实际游玩验证各种游戏机制是否正确
3. **AI测试**: 观察AI之间的对战,确保AI能够做出合法的决策

## 未来改进方向

1. **更智能的AI**: 实现Minimax算法或蒙特卡洛树搜索,使AI能够预测未来几步
2. **图形界面**: 使用Qt或SFML库实现图形用户界面
3. **网络对战**: 实现网络通信,支持远程对战
4. **扩展包支持**: 添加《万神殿》等扩展包的内容
5. **保存/加载游戏**: 实现游戏状态的序列化和反序列化

## 总结

本项目成功实现了一个功能完整、结构清晰的7 Wonders Duel游戏。通过面向对象的设计,项目具有良好的可维护性和可扩展性。项目不仅实现了游戏的所有核心机制,还提供了AI对战功能,使得玩家可以与计算机对战或观看AI之间的对局。

项目的代码质量较高,遵循了C++的最佳实践,使用了现代C++特性(如智能指针的潜在使用空间、STL容器等)。整体而言,这是一个成功的面向对象编程实践项目。
